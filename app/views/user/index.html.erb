<% title "Account Page" %>
<h3>Tenders You are watching</h3>

 <%if false%>
  <%= button_to "Test email", {:action => "sendAlert", :user_id => @userID}, :remote => true %>
 <%end%>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Email Alerts</th>
      <th>name</th>
      <th>type</th>
      <th>status</th>
      <th>estimated value</th>
    </tr>
  </thead>
  <tbody>
    <% count = 0 %>
    <% @watched_tenders.each do |watch_tender| %>
      <% count = count + 1 %>
      <% buttonID = "tender_watch_button_"+count.to_s %>
      <% highlightClass = "" %>
      <% if watch_tender.has_updated %>
        <% highlightClass = 'class="bidwinner"'.html_safe %>
      <% end %>
      <tr>
        <% if watch_tender.email_alert %>
          <td <%=highlightClass%>><div <%= "id = "+buttonID %> ><%= button_to "Unsubscribe", {:action => "unsubscribe_tender", :tender_watch_id => watch_tender.id, :buttonID => buttonID}, :remote => true %></div></td>
        <% else %>
          <td <%=highlightClass%>><div <%= "id = "+buttonID %> ><%= button_to "Subscribe", {:action => "subscribe_tender", :tender_watch_id => watch_tender.id, :buttonID => buttonID}, :remote => true %></div></td>
        <% end %>
        <% tender = Tender.where(:url_id => watch_tender.tender_url ) %>
        <% highlights = nil %>
        <% if watch_tender.has_updated %>
          <% highlights = watch_tender.hash %>
        <% end %>
        <td <%=highlightClass%>><%= link_to tender.tender_registration_number, tender_path(:id => tender.id, :highlights => highlights) %></td>
        <td <%=highlightClass%>><%= t(tender.tender_type) %></td>
        <td <%=highlightClass%>><%= t(tender.tender_status) %></td>
        <td <%=highlightClass%>><%= tender.estimated_value %></td>
        <td <%=highlightClass%>><%= button_to "delete", {:action => "remove_tender_watch_from_account", :tender_url => tender.url_id} %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>
<h3>Your saved searches</h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Email Alerts</th>
      <th>Name</th>
      <th>Type</th>
      <th>Date saved</th>
    </tr>
  </thead>
  <tbody>
    <% @savedSearches.each do |search| %>
      <% count = count + 1 %>
      <% buttonID = "tender_watch_button_"+count.to_s %>
      <% highlightClass = "" %>
       <% if search.has_updated %>
        <% highlightClass = 'class="bidwinner"'.html_safe %>
      <% end %>
      <tr>
        <% if search.email_alert %>
          <td <%=highlightClass%>><div id="<%= buttonID %>"> <%= button_to "Unsubscribe", {:action => "unsubscribe_search", :search_id => search.id, :buttonID => buttonID}, :remote => true %></div></td>
        <% else %>
          <td <%=highlightClass%>><div id="<%= buttonID %>"> <%= button_to "Subscribe", {:action => "subscribe_search", :search_id => search.id, :buttonID => buttonID}, :remote => true %></div></td>
        <% end %>
        <td <%=highlightClass%>><%= link_to search.name, :controller => "tender", :action => "search_via_saved", :search_id => search.id %></td>
        <td <%=highlightClass%>><%= search.searchtype %></td>
        <td <%=highlightClass%>><%= search.created_at %></td>
        <td <%=highlightClass%>><%= button_to "delete", {:action => "remove_search_from_account", :search_id => search.id} %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>
<h3>Your CPV groups</h3>
<%= render :partial => "user/cpvGroups", :locals => {:cpvGroups => @cpvGroups, :referrer => "user"} %>
