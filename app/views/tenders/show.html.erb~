<%- model_class = Tender -%>
<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human %></h1>
</div>

<% if user_signed_in? %>
  <div class="tender_subscription">
    <% if @isWatched %>
      <%= button_to "Remove from Profile", {:controller => :user, :action => "remove_tender_watch", :tender_url => @tenderUrl, :user_id => current_user.id}, :remote => true %>
    <% else %>
      <%= button_to "Save to Profile", {:controller => :user, :action => "add_tender_watch", :tender_url => @tenderUrl, :tender_id => @tender.id, :user_id => current_user.id}, :remote => true %>
    <% end %>
  </div>
<% end %>

<dl class="info-horizontal">
  <% highlightClass = "" %>
  <% if @highlights.include?('procurring_entity_id') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:procurring_entity_id) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= link_to @procurer, :controller => "organizations", :action => "show_procurer", :id => @tender.procurring_entity_id %></td>

  <% highlightClass = "" %>
  <% if @highlights.include?('tender_type') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:tender_type) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= t(@tender.tender_type) %></dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('tender_registration_number') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:tender_registration_number) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= @tender.tender_registration_number %></dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('tender_status') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:tender_status) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= t(@tender.tender_status) %></dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('tender_announcement_date') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:tender_announcement_date) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= @tender.tender_announcement_date %></dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('bid_start_date') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:bid_start_date) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= @tender.bid_start_date %></dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('bid_end_date') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:bid_end_date) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= @tender.bid_end_date %></dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('bid_start_date') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong>Bidding Duration:</strong></dt>
  <dd <%=highlightClass%> ><%= (@tender.bid_end_date - @tender.bid_start_date).to_i %> days</dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('estimated_value') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:estimated_value) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= @tender.estimated_value %></dd>

  <% highlightClass = "" %>
  <% if @highlights.include?('cpv_code') %>
    <% highlightClass = 'class="bidwinner"'.html_safe %>
  <% end %>
  <dt <%=highlightClass%> ><strong><%= model_class.human_attribute_name(:cpv_code) %>:</strong></dt>
  <dd <%=highlightClass%> ><%= @tender.cpv_code %> - <%= @cpv.description_english %></dd>
  
</dl>

  <br><br>
  Risk Score = <%= @totalRisk %>
  <% if @totalRisk > 0 %>
    <br>
    <% @risks.each do |risk| %>
      <%= risk.name %>
      <br>
    <% end %>
  <% end %> 

<br><br><br>

<h3> Bidding Result </h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Contract Type</th>
      <th>Organization</th>
      <th>Contract Value</th>
      <th>Start Date</th>
      <th>Expiry Date</th>
      <th>Documentation</th>
    </tr>
  </thead>
  <tbody>
    <% @agreementInfo.each do |agreement| %>
      <% if agreement[:value] == -1 %>
        <tr>
          <td><%= agreement[:Type] %></td>
          <td><%= link_to agreement[:OrgName], organization_path(agreement[:OrgID]) %></td>
          <td><%= agreement[:document] %></td>
          <td><%= agreement[:startDate] %></td>        
        </tr> 
     <% else %>
        <tr>
          <td><%= agreement[:Type] %></td>
          <td><%= link_to agreement[:OrgName], organization_path(agreement[:OrgID]) %></td>
          <td><%= agreement[:value] %></td>
          <td><%= agreement[:startDate] %></td>
          <td><%= agreement[:expiryDate] %></td>
          <td><a href=<%= agreement[:document] %>>link</a></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
<br><br><br>
<h3>Participants</h3>

<table class="table table-striped">
  <thead>
    <tr>
      <th><%= model_class.human_attribute_name(:name) %></th>
      <th>First Bid</th>
      <th>Last Bid</th>
      <th>Number of Bids</th>
    </tr>
  </thead>
  <tbody>
    <% @bidderInfo.each do |info| %>
      <% if info[:won] %>
        <% myClass = 'class="bidwinner"'.html_safe %>
      <% else %>
        <% myClass = "" %>
       <% end %>
      <tr <%=myClass%>>
          <td <%=myClass%>><%= info[:highBid] %></td>
          <td <%=myClass%>><%= info[:lowBid] %></td>
          <td <%=myClass%>><%= info[:numBids] %></td>
       </tr>
    <% end %>
  </tbody>
</table>

