<%- model_class = Tender -%>
<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human %></h1>
</div>

<% if user_signed_in? %>
  <div class="tender_subscription">
    <% if @isWatched %>
      <%= button_to "Unsubscribe", {:controller => :user, :action => "unsubscribe_tender", :tender_url => @tenderUrl, :user_id => current_user.id}, :remote => true %>
    <% else %>
      <%= button_to "Subscribe", {:controller => :user, :action => "subscribe_tender", :tender_url => @tenderUrl, :user_id => current_user.id}, :remote => true %>
    <% end %>
  </div>
<% end %>

<dl class="info-horizontal">
  <dt><strong><%= model_class.human_attribute_name(:procurring_entity_id) %>:</strong></dt>
  <td><%= link_to @procurer, :controller => "organizations", :action => "show_procurer", :id => @tender.procurring_entity_id %></td>
  <dt><strong><%= model_class.human_attribute_name(:tender_type) %>:</strong></dt>
  <dd><%= @tender.tender_type %></dd>
  <dt><strong><%= model_class.human_attribute_name(:tender_registration_number) %>:</strong></dt>
  <dd><%= @tender.tender_registration_number %></dd>
  <dt><strong><%= model_class.human_attribute_name(:tender_status) %>:</strong></dt>
  <dd><%= @tender.tender_status %></dd>
  <dt><strong><%= model_class.human_attribute_name(:tender_announcement_date) %>:</strong></dt>
  <dd><%= @tender.tender_announcement_date %></dd>
  <dt><strong><%= model_class.human_attribute_name(:bid_start_date) %>:</strong></dt>
  <dd><%= @tender.bid_start_date %></dd>
  <dt><strong><%= model_class.human_attribute_name(:bid_end_date) %>:</strong></dt>
  <dd><%= @tender.bid_end_date %></dd>

  <dt><strong>Bidding Duration:</strong></dt>
  <dd><%= (@tender.bid_end_date - @tender.bid_start_date).to_i %> days</dd>

  <dt><strong><%= model_class.human_attribute_name(:estimated_value) %>:</strong></dt>
  <dd><%= @tender.estimated_value %></dd>
  <dt><strong><%= model_class.human_attribute_name(:cpv_code) %>:</strong></dt>
  <dd><%= @tender.cpv_code %></dd>
</dl>

<br><br><br>
<h3> Bidding Result </h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Contract Type</th>
      <th>Organization</th>
      <th>Contract Value</th>
      <th>Start Date</th>
      <th>Expiry Date</th>
      <th>Documentation</th>
    </tr>
  </thead>
  <tbody>
    <% @agreementInfo.each do |agreement| %>
      <tr>
        <td><%= agreement[:Type] %></td>
        <td><%= link_to agreement[:OrgName], organization_path(agreement[:OrgID]) %></td>
        <td><%= agreement[:value] %></td>
        <td><%= agreement[:startDate] %></td>
        <td><%= agreement[:expiryDate] %></td>
        <td><a href=<%= agreement[:document] %>>link</a></td>
      </tr>
    <% end %>
  </tbody>
</table>
<br><br><br>
<h3>Participants</h3>

<table class="dataTable" cellpadding="0" cellspacing="0" border="0">
  <thead>
    <tr>
      <th><%= model_class.human_attribute_name(:name) %></th>
      <th>First Bid</th>
      <th>Last Bid</th>
      <th>Number of Bids</th>
    </tr>
  </thead>
  <tbody>
    <% @bidderInfo.each do |info| %>
      <% if info[:won] %>
        <% myClass = 'class="bidwinner"'.html_safe %>
      <% else %>
        <% myClass = "" %>
       <% end %>
      <tr <%=myClass%>>
          <td <%=myClass%>><%= link_to info[:name], organization_path(info[:id]) %></td>
          <td <%=myClass%>><%= info[:highBid] %></td>
          <td <%=myClass%>><%= info[:lowBid] %></td>
          <td <%=myClass%>><%= info[:numBids] %></td>
       </tr>
    <% end %>
  </tbody>
</table>

