<%= javascript_include_tag "tenders" %>

<%- model_class = Tender -%>
<div class="page-header">
  <h1><%=t '.title', :default => t("Tenders") %></h1>
</div>

<% if user_signed_in? %>
  <div class="search_serialization">
    <% if @searchIsSaved %>
      <%= render "user/remove_form" %>
    <% else %>
      <%= render "user/save_form" %>
    <% end %>
  </div>
  <br>
<% end %>
  
  <% csvParams = @params.clone%>
  <% csvParams[:format] = "csv" %>
  <% csvParams[:controller] = "tender" %>
  <% csvParams[:action] = "download" %>

  <%= t("Number of Results")%> : <%= @numResults %>
  <%= button_to "Download CSV",  csvParams, :class => "submit-button" %>
    <hr>
    <table class="table table-striped">
      <thead>
        <tr>
          <th class="arrow"><%= sortable(@params, t("Tender Registration Number"), "Tender") %></th>
          <th class="header-20 arrow"><%= sortable(@params, "procurer_name", t("Procurer")) %></th>
          <th class="header-10 arrow"><%= sortable(@params, "supplier_name", t("Supplier")) %></th>
          <th class="arrow"><%= sortable(@params, "tender_announcement_date", t("Date")) %></th>
          <th class="arrow"><%= sortable(@params, "cpv_code", t("CPV"))%></th>
          <th class="arrow"><%= sortable(@params, "tender_type", t("Type")) %></th> 
          <th class="arrow"><%= sortable(@params, "tender_status", t("Status")) %></th>
          <th class="arrow"><%= sortable(@params, "estimated_value", "Est. Value") %></th>
          <th class="header-10 arrow"><%= sortable(@params, "contract_value", t("Actual Value"))%></th>
          <th class="header-7 arrow"><%= sortable(@params, "num_bidders", "Bidders")%></th>
        </tr>
      </thead>
      
      <tbody>
        <%= page_navigation_links @tenders %>
        <% @results.each do |item| %>
          <% tender = item[:tender] %>
          <% highlightClass = 'class="no-overflow"'.html_safe %>
          <% if @search and @search.last_viewed < tender.updated_at %>
            <% highlightClass = 'class="no-overflow bidwinner"'.html_safe %>
          <% end %>
          <tr>
            <td <%=highlightClass%>><%= link_to tender.tender_registration_number, tender_path(tender) %></td>
            <td <%=highlightClass%>><%= link_to tender.procurer_name.split("#")[0], :controller => "organizations", :action => "show_procurer", :id => tender.procurring_entity_id %></td>

            <% if tender.supplier_name %>
              <td <%=highlightClass%>><%= link_to tender.supplier_name.split("#")[0], :controller => "organizations", :action => "show", :id => tender.winning_org_id %></td>
            <% else %>
              <td <%=highlightClass%>>N/A</td>
            <% end %>
            <td <%=highlightClass%>><%= tender.tender_announcement_date %></td>
            <td <%=highlightClass%>><%= tender.cpv_code %></td>
            <td <%=highlightClass%>><%= t(tender.tender_type.strip()) %></td>
            <td <%=highlightClass%>><%= t(tender.tender_status) %></td>
            <td <%=highlightClass%>><%= tender.estimated_value %></td>
            <td <%=highlightClass%>><% if tender.contract_value %><%= tender.contract_value %><%else%>N/A<%end%></td>
            <td <%=highlightClass%>><%= tender.num_bidders %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <%= page_navigation_links @tenders %>
