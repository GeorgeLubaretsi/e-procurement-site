<style type="text/css">
  div.arrow { background:transparent url("/assets/arrows.png") no-repeat scroll 0px -16px; width:16px; height:16px; display:block;}
  div.up { background-position:0px 0px;}
</style>

<script>
var chart1; // globally available
$(document).ready(function() {
    groupChart = new Highcharts.Chart({
       chart: {
          renderTo: 'groupGraph',
          type: 'bar'
       },
       title: {
          text: 'Top 10 Groups'
       },
       xAxis: {
          categories: [
             <% @majorGroups.each do |info| %>
              '<%= info[:name]%>',
             <% end %>
          ]
       },
       yAxis: {
          title: {
             text: 'Lari'
          }
       },
       series: [        
               {
                name: "Awarded Contract Total",
                data: [ <% @majorGroups.each do |info| %> <%= info[:total] %>, <% end %>]
               },  
      ]   
    });

 });
</script>

<div class="tabs">
  <ul>
    <li><a href="#tabs-1"><%=t("Search Tenders")%></a></li>
    <li><a href="#tabs-2"><%=t("Search Companies")%></a></li>
    <li><a href="#tabs-3"><%=t("Search Procurers")%></a></li>
  </ul>
  <div id="tabs-1">
    <%= form_tag({:controller => "tender", :action => "search"}, :method => "get") do %>
      <div class="row-fluid">
        <div class="span4 offset4">
          <label for="keyword"><%=t("Keyword Search")%></label>
          <input name="keyword" type="text" />
        </div>
      </div>
      <div class="row-fluid">
        <div class="span4 offset4">
          <%= submit_tag( t('Search')) %>
        </div>
      </div>
      
      <div class="row-fluid">
        <div class="span3">
          <label for="tender_status"><%=t("Status")%></label>
          <% options = [] %>
          <% @uniqueStatus.each do |status| %>
            <% options.push(item = [t(status),status]) %>
          <% end %>
          <%= select_tag(:tender_status, options_for_select(options), :include_blank => true)  %>
        </div>
        <div class="span3">        
          <label for="cpvGroup"><%= t("Category")%></label>
          <%= select_tag(:cpvGroup, options_from_collection_for_select(@cpvGroups, :id, :name)) %>
        </div>
        <div class="span3">
          <label for="risk_indicator"><%=t("Risk Indicator")%> </label>
          <%= select_tag(:risk_indicator,  options_from_collection_for_select(@indicators,:id,:name),{:include_blank => true})  %>
        </div>
        <div class="span3">
          <label for="type"><%=t("Type")%> </label>
          <% options = [] %>
          <% @uniqueTypes.each do |type| %>
            <% options.push(item = [t(type.strip()),type]) %>
          <% end %>
          <%= select_tag(:type,  options_for_select(options),{:include_blank => true})  %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span4 offset4" id="advancedToggle">
          Advanced 
          <div class="arrow"></div>
        </div>
      </div>
      <div class="row-fluid" id="advancedDiv">          
        <div class="span3 offset1">
          <label for="min_estimate"><%=t("Minimum Cost Estimate")%></label>
          <input name="min_estimate" type="text"/>
          <label for="max_estimate"><%=t("Maximum Cost Estimate")%></label>
          <input name="max_estimate" type="text"/>

          <label for="min_num_bids"><%=t("Min Number Of Bids")%></label>
          <input name="min_num_bids" type="text"/>
          <label for="max_num_bids"><%=t("Max Number Of Bids")%></label>
          <input name="max_num_bids" type="text"/>

          <label for="min_num_bidders"><%=t("Min Number Of Bidders")%></label>
          <input name="min_num_bidders" type="text"/>
          <label for="max_num_bidders"><%=t("Max Number Of Bidders")%></label>
          <input name="max_num_bidders" type="text"/>
        </div>
        <div class="span3" >
          <label for="tender_registration_number"><%=t("Registration Code")%></label>
          <input name="tender_registration_number" type="text"/>
          <label for="announced_after"><%=t("Announced After")%></label>
          <input name="announced_after" type="text" class="dp2" value="" data-date-format="yyyy/mm/dd" id="dp2"/>
          <label for="announced_before"><%=t("Announced Before")%></label>
          <input name="announced_before" type="text" class="dp2" value="" data-date-format="yyyy/mm/dd" id="dp3"/>
        </div>
        <div class="span3" >
          <label for="procurer"><%=t("Procurer")%></label>
          <input class="proc_search" name="procurer" type="text"/>
          <label for="supplier"><%=t("Supplier")%></label>
          <input class="supply_search" name="supplier" type="text"/>
        </div>
      </div>
    <% end %>
  </div>
  <div id="tabs-2">
    <div class="search-org">
      <%= form_tag({:controller => "organization", :action => "search"}, :method => "get") do %>
        <label for="name"><%=t("Name")%></label>
        <input class="supply_search" name="name" type="text"/>

        <label for="code"><%=t("Code")%></label>
        <input name="code" type="text"/>

        <label for="org_type"><%=t("Type")%></label>
        <% types = [] %>
        <% @orgTypes.each do |orgType| %>
          <% types.push(item = [t(orgType),orgType]) %>
        <%end%>
        <%= select_tag(:org_type, options_for_select(types), :include_blank => true)  %>

        <label for="email"><%=t("Email")%></label>
        <input name="email" type="text"/>
        <label for="address"><%=t("Address")%></label>
        <input name="address" type="text"/>
        <label for="city"><%=t("City")%></label>
        <input name="city" type="text"/>
        <label for="phone_number"><%=t("Phone Number")%></label>
        <input name="phone_number" type="text"/>

        <%= label_tag(:isForeign, "Only Foreign") %>
        <%= check_box_tag(:isForeign) %>
        <br>
        <%= submit_tag( t('Search')) %>
      <% end %>
     </div>
  </div>
  <div id="tabs-3">
    <div class="search-org">
      <%= form_tag({:controller => "organization", :action => "search_procurer"}, :method => "get") do %>
        <label for="name"><%=t("Name")%></label>
        <input class="proc_search" name="name" type="text"/>

        <label for="code"><%=t("Code")%></label>
        <input name="code" type="text"/>

        <label for="org_type"><%=t("Type")%></label>
        <% types = [] %>
        <% @procTypes.each do |orgType| %>
          <% orgType = orgType.gsub(".","") %>
          <% types.push(item = [t(orgType),orgType]) %>
        <% end %>
        <%= select_tag(:org_type, options_for_select(types), :include_blank => true )%>
        <%= submit_tag( t('Search')) %>
      <% end %>
    </div>
  </div>
</div>



<div class="tabs ui-tabs">
  <ul>
    <li><a href="#tabs-1"><%=t("Top CPV Groups")%></a></li>
    <li><a href="#tabs-2"><%=t("Top Suppliers")%></a></li>
    <li><a href="#tabs-3"><%=t("Top Procurers")%></a></li>
  </ul>

  
  <div id="tabs-1">
    <div class="row-fluid">
      <div id="groupGraph"></div>   
    </div>
  </div>

  <div id="tabs-2">
    <div class="row-fluid">
      <div class="span8 offset4">
        <h4><%=t("Sector")%></<h4><br>
        <%= select_tag(:cpvGroup, options_from_collection_for_select(@cpvGroups, :id, :name), 
          :data => { :remote => true, 
                     :url => url_for(:controller => "root", 
                     :action => "cpvVsCompany") } )  %>     
      </div>
    </div>
    <div class="row-fluid">
      <div id="graph"></div>   
    </div>
  </div>
  <div id="tabs-3">
      <div class="row-fluid">
        <div class="span8 offset4">
          <h4><%=t("Sector")%></<h4><br>
          <%= select_tag(:cpvGroup, options_from_collection_for_select(@cpvGroups, :id, :name), 
            :data => { :remote => true, 
                       :url => url_for(:controller => "root", 
                       :action => "cpvVsProcurer") } )  %>     
        </div>
      </div>

    <div class="row-fluid">
      <div id="procGraph"></div>   
    </div>
  </div>

</div>



