<script>
var chart1; // globally available
$(document).ready(function() {
    chart1 = new Highcharts.Chart({
       chart: {
          renderTo: 'graph',
          type: 'bar'
       },
       title: {
          text: '<%= t("Top Ten Players") %>'
       },
       xAxis: {
          categories: [
             <% @TopTen.each do |info| %>
              <% item = link_to( raw(info[:company].name),  :controller => "organizations", :action => "show", :id => info[:company].id)%>
              '<%= item%>',
             <% end %>
          ]
       },
       yAxis: {
          title: {
             text: 'Lari'
          }
       },
       series: [        
               {
                name: '<%=t("Awarded Contract Total")%>',
                data: [ <% @TopTen.each do |info| %> <%= info[:total] %>, <% end %>]
               },  
      ]   
    });
 });
</script>

<div class="container-fluid">
  <div class="row-fluid" id="mid-row">
    <div class="span3 search-tender">
      <h4><%=t("Search Tenders")%></<h4>
      <%= form_for Tender.new, :url => {:controller => "tender", :action => "search"}, :method => 'get' do |f| %>
      <br>
      <label for="tender_status"><%=t("Status")%></label>
      <% options = [] %>
      <% @uniqueStatus.each do |status| %>
        <% options.push(item = [t(status),status]) %>
      <% end %>
      <%= select_tag(:tender_status, options_for_select(options), :include_blank => true)  %>

      <label for="cpvGroup"><%= t("Category")%></label>
      <%= select_tag(:cpvGroup, options_from_collection_for_select(@cpvGroups, :id, :name)) %>
      <label for="risk_indicator"><%=t("Risk Indicator")%> </label>
      <%= select_tag(:risk_indicator,  options_from_collection_for_select(@indicators,:id,:name),{:include_blank => true})  %>

      <label for="tender_registration_number"><%=t("Registration Code")%></label>
      <input name="tender_registration_number" type="text"></text_field>
      <label for="announced_after"><%=t("Announced After")%></label>
      <input name="announced_after" type="text" class="dp2" value="" data-date-format="yyyy/mm/dd" id="dp2" >
      <label for="announced_before"><%=t("Announced Before")%></label>
      <input name="announced_before" type="text" class="dp2" value="" data-date-format="yyyy/mm/dd" id="dp3" >
      
      <label for="min_estimate"><%=t("Minimum Cost Estimate")%></label>
      <input name="min_estimate" type="text"></text_field>
      <label for="max_estimate"><%=t("Maximum Cost Estimate")%></label>
      <input name="max_estimate" type="text"></text_field>

      <label for="min_num_bids"><%=t("Min Number Of Bids")%></label>
      <input name="min_num_bids" type="text"></text_field>
      <label for="max_num_bids"><%=t("Max Number Of Bids")%></label>
      <input name="max_num_bids" type="text"></text_field>

      <label for="min_num_bidders"><%=t("Min Number Of Bidders")%></label>
      <input name="min_num_bidders" type="text"></text_field>
      <label for="max_num_bidders"><%=t("Max Number Of Bidders")%></label>
      <input name="max_num_bidders" type="text"></text_field>
      
      <br>
      <%= submit_tag( t('Search')) %>
    <% end %>
    </div>
    <div class="span8 offset1">
      <div class="row-fluid">
        <div class="span6 search-org">
          <h4><%=t("Search Companies")%></<h4>
          <%= form_for Organization.new, :url => { :controller => "organization", :action => "search" }, :method => 'get' do |f| %>
            <br>
            <label for="name"><%=t("Name")%></label>
            <%= f.text_field  :name %>

            <label for="code"><%=t("Code")%></label>
            <%= f.text_field :code %>

            <label for="org_type"><%=t("Type")%></label>
            <% types = [] %>
            <% @orgTypes.each do |orgType| %>
              <% types.push(item = [t(orgType),orgType]) %>
            <%end%>
            <%= select_tag(:org_type, options_for_select(types), :include_blank => true)  %>


            <label for="isForeign"><%=t("Only Foreign")%></label>
            <%= check_box("isForeign","foreign") %>
            <br>
            <%= submit_tag( t('Search')) %>
          <% end %>
        </div>
        <div class="span6 search-org">
          <h4><%=t("Search Procurers")%></<h4>
          <%= form_for Organization.new, :url =>  { :controller => "organization", :action => "search_procurer" }, :method => 'get' do |f| %>
            <br>
            <label for="name"><%=t("Name")%></label>
            <%= f.text_field  :name %>

            <label for="code"><%=t("Code")%></label>
            <%= f.text_field :code %>

            <label for="org_type"><%=t("Type")%></label>
            <% types = [] %>
            <% @procTypes.each do |orgType| %>
              <% orgType = orgType.gsub(".","") %>
              <% types.push(item = [t(orgType),orgType]) %>
            <% end %>
            <%= select_tag(:org_type, options_for_select(types), :include_blank => true )%>
            <br>
            <%= submit_tag( t('Search')) %>
          <% end %>
        </div>
      </div>
      <div class="row-fluid graph-row">
        <div class="span8 offset4">
          <h4><%=t("Show Major Players")%></<h4><br>
            <%= select_tag(:cpvGroup, options_from_collection_for_select(@cpvGroups, :id, :name), 
                :data => { :remote => true, 
                           :url => url_for(:controller => "root", 
                           :action => "cpvVsCompany") } )  %>     
        </div>
      </div>
      <div class="row-fluid">
        <div id="graph" style="width: 100%; height: 100%"></div>   
      </div>
    </div>
  </div>
</div>



